<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ru">

{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Анализ игр: Равновесие Нэша и Итеративные игры</title>
    <link rel="stylesheet" href="{% static 'styles/nash.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Montserrat:wght@600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>
<body class="light">
    <div class="container">
        <header>
            <h1>Анализ игр: Равновесие Нэша и Итеративные игры</h1>
        </header>
        <div class="theme-switcher">
            <label for="theme-select">Тема:</label>
            <select id="theme-select">
                <option value="light">Светлая тема</option>
                <option value="dark">Тёмная тема</option>
            </select>
        </div>
        <nav class="tab-nav">
            <button class="tab-button active" data-tab="matrix-tab">Равновесие Нэша</button>
            <button class="tab-button" data-tab="iterative-tab">Итеративные игры</button>
            <button class="tab-button" data-tab="nash-tab">Полезное о равновесии Нэша</button>
            <button class="tab-button" data-tab="strategies-tab">Полезное об итеративных играх</button>
        </nav>
        <div class="tab-content">
            <div id="matrix-tab" class="tab-pane active">
                <div class="control-panel">
                    <div class="input-section">
                        <label for="rows">Строки (A):</label>
                        <input type="number" id="rows" min="2" max="5" value="2">
                        <label for="cols">Столбцы (B):</label>
                        <input type="number" id="cols" min="2" max="5" value="2">
                        <button id="fill-matrix-btn">Создать и заполнить матрицу</button>
                    </div>
                </div>
                <div id="matrix-input"></div>
                <button id="calculate-btn">Рассчитать</button>
                <div id="matrix-output"></div>
                <div id="matrix-chart"></div>
                <div class="modal" id="matrix-fill-modal">
                    <div class="modal-content">
                        <h3>Выберите способ заполнения матрицы</h3>
                        <select id="matrix-fill-type">
                            <option value="zeros">Нули</option>
                            <option value="random">Случайные значения</option>
                            <option value="prisoner">Дилемма заключённого</option>
                            <option value="coordination">Координация</option>
                            <option value="battle">Битва полов</option>
                        </select>
                        <p id="matrix-fill-note" style="display: none;">Пресеты доступны только для матрицы 2×2.</p>
                        <div class="modal-buttons">
                            <button id="matrix-fill-confirm">Подтвердить</button>
                            <button id="matrix-fill-cancel">Отмена</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="iterative-tab" class="tab-pane">
                <div id="iterative-controls">
                    <div class="input-section">
                        <label for="iterative-rows">Строки (A):</label>
                        <input type="number" id="iterative-rows" min="2" max="5" value="2">
                        <label for="iterative-cols">Столбцы (B):</label>
                        <input type="number" id="iterative-cols" min="2" max="5" value="2">
                        <button id="fill-iterative-matrix-btn">Создать и заполнить матрицу</button>
                    </div>
                    <div class="input-section">
                        <label for="player-a-strategy">Личность игрока A:</label>
                        <select id="player-a-strategy" class="strategy-select">
                            <option value="altruist">Альтруист</option>
                            <option value="greedy">Скряга</option>
                            <option value="rationalist">Рационалист</option>
                            <option value="madman">Безумец</option>
                            <option value="ii-agent">ИИ-агент</option>
                        </select>
                        <label for="player-b-strategy">Личность игрока B:</label>
                        <select id="player-b-strategy" class="strategy-select">
                            <option value="altruist">Альтруист</option>
                            <option value="greedy">Скряга</option>
                            <option value="rationalist">Рационалист</option>
                            <option value="madman">Безумец</option>
                            <option value="ii-agent">ИИ-агент</option>
                        </select>
                    </div>
                    <div class="input-section">
                        <label for="balance-a">Стартовый баланс A:</label>
                        <input type="number" id="balance-a" min="0" value="100">
                        <label for="balance-b">Стартовый баланс B:</label>
                        <input type="number" id="balance-b" min="0" value="100">
                        <label for="iterations">Итерации (5–100):</label>
                        <input type="number" id="iterations" min="5" max="100" value="20">
                        <button id="run-simulation">Запустить симуляцию</button>
                    </div>
                </div>
                <div id="iterative-matrix-input"></div>
                <div id="iterative-results"></div>
                <div id="iterative-chart"></div>
                <div class="modal" id="iterative-fill-modal">
                    <div class="modal-content">
                        <h3>Выберите способ заполнения матрицы</h3>
                        <select id="iterative-fill-type">
                            <option value="zeros">Нули</option>
                            <option value="random">Случайные значения</option>
                            <option value="prisoner">Дилемма заключённого</option>
                            <option value="coordination">Координация</option>
                            <option value="battle">Битва полов</option>
                        </select>
                        <p id="iterative-fill-note" style="display: none;">Пресеты доступны только для матрицы 2×2.</p>
                        <div class="modal-buttons">
                            <button id="iterative-fill-confirm">Подтвердить</button>
                            <button id="iterative-fill-cancel">Отмена</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="nash-tab" class="tab-pane">
                <h2>О теории игр и равновесии Нэша</h2>
                <p>Теория игр — это раздел математики, изучающий стратегии взаимодействия различных агентов, принимающих решения. Она применяется в экономике, биологии, социологии и даже в повседневной жизни. Центральной концепцией теории игр является равновесие Нэша, названное в честь лауреата Нобелевской премии Джона Нэша.</p>
                <h3>Что такое равновесие Нэша?</h3>
                <p>Равновесие Нэша — это состояние в игре, при котором ни один игрок не может улучшить свой выигрыш, изменив свою стратегию, если стратегии других игроков остаются неизменными. Это устойчивая точка, где все участники удовлетворены своим выбором при заданных условиях.</p>
                <h3>Как найти равновесие Нэша?</h3>
                <p>Для игр с двумя игроками и конечным числом стратегий процесс поиска равновесия Нэша включает следующие шаги:</p>
                <ul>
                    <li>Для каждой стратегии Игрока А определить наилучший ответ Игрока B (стратегию, максимизирующую выигрыш B).</li>
                    <li>Для каждой стратегии Игрока B определить наилучший ответ Игрока A (стратегию, максимизирующую выигрыш A).</li>
                    <li>Найти комбинации стратегий, где оба игрока одновременно выбирают лучший ответ — это равновесие Нэша.</li>
                </ul>
                <p>В матрице выигрышей равновесие Нэша — это ячейка, где выигрыш одного игрока максимален в своём столбце, а другого — в своей строке.</p>
                <h3>Классические примеры из теории игр</h3>
                <p>Ниже приведены известные примеры игр с таблицами выигрышей и анализом равновесия Нэша.</p>
                <h4>1. Дилемма заключённого</h4>
                <p>Два подозреваемых (Игрок A и Игрок B) задержаны полицией — у каждого есть выбор: молчать (сотрудничать друг с другом) или свидетельствовать (предать). Выигрыши каждого игрока (меньше — хуже):</p>
                <table>
                    <tr>
                        <th></th>
                        <th>Молчать (B)</th>
                        <th>Свидетельствовать (B)</th>
                    </tr>
                    <tr>
                        <th>Молчать (A)</th>
                        <td>-1;-1</td>
                        <td>-10;0</td>
                    </tr>
                    <tr>
                        <th>Свидетельствовать (A)</th>
                        <td>0;-10</td>
                        <td>-5;-5</td>
                    </tr>
                </table>
                <p><strong>Анализ:</strong></p>
                <ul>
                    <li>Если Игрок B молчит, Игроку A лучше свидетельствовать (0 лучше, чем -1).</li>
                    <li>Если Игрок B свидетельствует, Игроку A лучше свидетельствовать (-5 лучше, чем -10).</li>
                    <li>То же для Игрок B: свидетельствовать всегда лучше.</li>
                </ul>
                <p><strong>Равновесие Нэша:</strong> (Свидетельствовать, Свидетельствовать) с выигрышами -5;-5. Это единственное равновесие, хотя оба могли бы получить -1;-1 при взаимном молчании.</p>
                <h4>2. Игра "Координация"</h4>
                <p>Два друга (Игрок A и Игрок B) решают, куда пойти: в кино или на концерт. Они счастливы, только если выберут одно и то же место.</p>
                <table>
                    <tr>
                        <th></th>
                        <th>Кино (B)</th>
                        <th>Концерт (B)</th>
                    </tr>
                    <tr>
                        <th>Кино (A)</th>
                        <td>2;2</td>
                        <td>0;0</td>
                    </tr>
                    <tr>
                        <th>Концерт (A)</th>
                        <td>0;0</td>
                        <td>3;3</td>
                    </tr>
                </table>
                <p><strong>Анализ:</strong></p>
                <ul>
                    <li>Если Игрок B выбирает кино, Игроку A лучше выбрать кино (2 лучше, чем 0).</li>
                    <li>Если Игрок B выбирает концерт, Игроку A лучше выбрать концерт (3 лучше, чем 0).</li>
                    <li>Симметрично для Игрок B.</li>
                </ul>
                <p><strong>Равновесие Нэша:</strong> (Кино, Кино) с выигрышами 2;2 и (Концерт, Концерт) с выигрышами 3;3. Здесь два равновесия, показывающие важность координации.</p>
                <h4>3. Битва полов</h4>
                <p>Пара в июне решает, куда пойти: на футбол или в оперу. Они предпочтут остаться вместе, но у каждого есть свои приоритеты (мужчина хочет на футбол, а женщина — в оперу).</p>
                <table>
                    <tr>
                        <th></th>
                        <th>Футбол (Муж)</th>
                        <th>Опера (Муж)</th>
                    </tr>
                    <tr>
                        <th>Футбол (Жена)</th>
                        <td>3;2</td>
                        <td>0;0</td>
                    </tr>
                    <tr>
                        <th>Опера (Жена)</th>
                        <td>0;0</td>
                        <td>2;3</td>
                    </tr>
                </table>
                <p><strong>Анализ:</strong></p>
                <ul>
                    <li>Если Жена выбирает футбол, Мужу лучше выбрать футбол (3 лучше, чем 0).</li>
                    <li>Если Жена выбирает оперу, Мужу лучше выбрать оперу (2 лучше, чем 0).</li>
                    <li>Симметрично для Жены: (футбол, футбол) с выигрышами 3;2 и (Опера, Опера) с выигрышами 2;3.</li>
                </ul>
                <p><strong>Равновесие Нэша:</strong> (Футбол, Футбол) с выигрышами 3;2 и (Опера, Опера) с выигрышами 2;3. Здесь два равновесия, показывающие важность координации.</p>
                <h3>Как использовать это приложение?</h3>
                <p>Приложение позволяет:</p>
                <ul>
                    <li>Создать матрицу выигрышей (от 2×2 до 5×5).</li>
                    <li>Ввести её вручную или же заполнить случайными значениями.</li>
                    <li>Найти для имеющейся матрицы равновесия Нэша (приложение подсвечивает соответствующие ячейки).</li>
                    <li>Получить столбчатую диаграмму всех возможных выигрышей игроков.</li>
                </ul>
                <p>Экспериментируйте с примерами выше или создайте свои сценарии!</p>
            </div>
            <div id="strategies-tab" class="tab-pane">
                <h2>О личностях в итеративных играх</h2>
                <p>В итеративных играх игроки многократно взаимодействуют, выбирая свои ходы на основе знаний о матрице выигрышей и предыдущих ходах оппонента. В этом приложении реализованы четыре типа личности (личностей): Альтруист, Скряга, Рационалист и Безумец. Каждая личность отражает уникальный подход к принятию решений, и их взаимодействие создаёт динамику, которую можно наблюдать через графики балансов игроков и результатов игры.</p>
                <h3>1. Альтруист</h3>
                <p>Альтруист стремится максимизировать суммарный выигрыш обоих игроков, жертвуя собственным интересом ради общего блага. Эта личность ориентирована на сотрудничество и поиск решений, выгодных для всех.</p>
                <p><strong>Алгоритм поведения:</strong> Альтруист в каждой итерации выбирает личность, которая ведёт к наибольшей сумме выигрышей обоих игроков (A + B) в матрице. После первого раунда он учитывает последний ход оппонента, рассматривая только комбинации, где второй игрок его повторяет. Если есть несколько вариантов с одинаковой суммой, то Альтруист выбирает случайный из них.</p>
                <p><strong>Пример в "Дилемме заключённого":</strong></p>
                <table>
                    <tr>
                        <th></th>
                        <th>Молчать (B)</th>
                        <th>Свидетельствовать (B)</th>
                    </tr>
                    <tr>
                        <th>Молчать (A)</th>
                        <td>-1;-1</td>
                        <td>-10;0</td>
                    </tr>
                    <tr>
                        <th>Свидетельствовать (A)</th>
                        <td>0;-10</td>
                        <td>-5;-5</td>
                    </tr>
                </table>
                <p>Альтруист выберет "Молчать" в первом раунде, так как сумма выигрышей (-1 + -1 = -2) максимальна. Если оппонент (B) выбрал "Свидетельствовать" в прошлом раунде, Альтруист рассмотрит комбинации (Молчать, Свидетельствовать) и (Свидетельствовать, Свидетельствовать) и может выбрать любую из них (сумма -10 + 0 = -10 равна -5 + -5 = -10).</p>
                <h3>2. Скряга</h3>
                <p>Скряга эгоистичен и стремится максимизировать только свой собственный выигрыш, игнорируя интересы оппонента. Это — жадная личность, которая ищет наибольшую возможную личную выгоду.</p>
                <p><strong>Алгоритм поведения:</strong> Скряга выбирает стратегию, которая ведёт к его наибольшему выигрышу в матрице. После первого раунда он учитывает последний ход оппонента, рассматривая только комбинации, где второй игрок его повторяет. Если есть несколько вариантов с равным выигрышем, то Скряга выбирает случайный из них.</p>
                <p><strong>Пример в "Дилемме заключённого":</strong></p>
                <table>
                    <tr>
                        <th></th>
                        <th>Молчать (B)</th>
                        <th>Свидетельствовать (B)</th>
                    </tr>
                    <tr>
                        <th>Молчать (A)</th>
                        <td>-1;-1</td>
                        <td>-10;0</td>
                    </tr>
                    <tr>
                        <th>Свидетельствовать (A)</th>
                        <td>0;-10</td>
                        <td>-5;-5</td>
                    </tr>
                </table>
                <p>Скряга выберет "Свидетельствовать" в первом раунде, так как возможный выигрыш 0 — наибольший. На следующей итерации независимо от хода оппонента Скряга выберет "Свидетельствовать" (т.к. если оппонент (B) выбрал "Молчать", то 0 лучше, чем -1, а если "Свидетельствовать", то -5 лучше, чем -10).</p>
                <h3>3. Рационалист</h3>
                <p>Рационалист адаптируется к ситуации, выбирая между альтруизмом и жадностью в зависимости от результатов предыдущих итераций. Он сотрудничает, если чувствует, что его выигрыш не хуже оппонента, иначе становится эгоистичным.</p>
                <p><strong>Алгоритм поведения:</strong> Рационалист действует как Альтруист (максимизирует суммарный выигрыш) в первом раунде и тогда, когда в предыдущем его выигрыш был не меньше, чем у оппонента, и как Скряга (максимизирует собственный выигрыш) в противном случае. Рационалист также учитывает прошлые ходы оппонента и предполагает, что он будет их повторять.</p>
                <p><strong>Пример в "Дилемме заключённого":</strong></p>
                <table>
                    <tr>
                        <th></th>
                        <th>Молчать (B)</th>
                        <th>Свидетельствовать (B)</th>
                    </tr>
                    <tr>
                        <th>Молчать (A)</th>
                        <td>-1;-1</td>
                        <td>-10;0</td>
                    </tr>
                    <tr>
                        <th>Свидетельствовать (A)</th>
                        <td>0;-10</td>
                        <td>-5;-5</td>
                    </tr>
                </table>
                <p>В первом раунде Рационалист действует как Альтруист, выбирая "Молчать" (сумма -2). Если в прошлом раунде он получил -10 (A: Молчать, B: Свидетельствовать), а оппонент 0, Рационалист станет Скрягой и выберет "Свидетельствовать" (-5 лучше, чем -10). Если после этого выигрыши станут равны (например, -5;-5), он вернётся к альтруизму.</p>
                <h3>4. Безумец</h3>
                <p>Безумец действует абсолютно хаотично, не придерживаясь какой-либо внутренней логики. Случайная стратегия считается одной из самых неэффективных, но в специфических случаях она может получать больший выигрыш.</p>
                <p><strong>Алгоритм поведения:</strong> Безумец на каждой итерации выбирает случайную стратегию из доступных (для игрока A — любая строка, для B — любой столбец), не учитывая ни матрицу, ни ходы оппонента.</p>
                <p><strong>Пример в "Дилемме заключённого":</strong></p>
                <table>
                    <tr>
                        <th></th>
                        <th>Молчать (B)</th>
                        <th>Свидетельствовать (B)</th>
                    </tr>
                    <tr>
                        <th>Молчать (A)</th>
                        <td>-1;-1</td>
                        <td>-10;0</td>
                    </tr>
                    <tr>
                        <th>Свидетельствовать (A)</th>
                        <td>0;-10</td>
                        <td>-5;-5</td>
                    </tr>
                </table>
                <p>Безумец случайно выбирает "Молчать" или "Свидетельствовать" с вероятностью 50%. Его выбор не зависит от действий оппонента или предыдущих раундов, что может привести к любому исходу (-1, -10, 0, -5 для A).</p>
                <h3>5. ИИ-агент (DeepSeek)</h3>
                <p>ИИ-агент — это интеллектуальная личность, которая использует большую языковую модель DeepSeek для выбора оптимальной стратегии в каждом раунде. ИИ-агент анализирует матрицу выигрышей, текущие балансы игроков, историю предыдущих ходов и количество оставшихся раундов, чтобы максимизировать свой выигрыш или опередить оппонента.</p>
                <p><strong>Алгоритм поведения:</strong> ИИ-агент отправляет запрос к API DeepSeek, передавая полное описание текущего состояния игры, включая доступные действия, матрицу выигрышей, счёта игроков и историю раундов. DeepSeek возвращает номер стратегии (действия), которая, по её оценке, приведёт к наибольшему выигрышу. Если API недоступен или возвращает ошибку, ИИ-агент выбирает случайную стратегию, как Безумец.</p>
                <p><strong>Пример в "Дилемме заключённого":</strong></p>
                <table>
                    <tr><th></th><th>Молчать (B)</th><th>Свидетельствовать (B)</th></tr>
                    <tr><th>Молчать (A)</th><td>-1;-1</td><td>-10;0</td></tr>
                    <tr><th>Свидетельствовать (A)</th><td>0;-10</td><td>-5;-5</td></tr>
                </table>
                <p>ИИ-агент отправляет DeepSeek информацию о матрице, текущем счёте и истории ходов. Например, если оппонент в прошлом раунде выбрал "Свидетельствовать", DeepSeek может порекомендовать "Свидетельствовать" (0 для A), чтобы минимизировать потери (-5 лучше, чем -10). Решение зависит от анализа DeepSeek, что делает поведение ИИ-агента адаптивным и непредсказуемым.</p>
                <h3>Взаимодействие личностей</h3>
                <p>В итеративных играх динамика зависит от сочетания личностей:</p>
                <ul>
                    <li><strong>Альтруист vs. Альтруист:</strong> оба стремятся к максимальной сумме выигрышей, всякий раз выбирая комбинацию с наибольшей такой суммой (например, "Молчать, Молчать" в "Дилемме заключённого").</li>
                    <li><strong>Скряга vs. Скряга:</strong> оба максимизируют личный выигрыш, что может привести к некооперативному равновесию (например, "Свидетельствовать, Свидетельствовать").</li>
                    <li><strong>Рационалист vs. Скряга:</strong> Рационалист начинает как Альтруист, но может сменить стратегию, если Скряга получает больше, что ведёт к конкуренции и неоднозначному поведению.</li>
                    <li><strong>Безумец vs. любой:</strong> Безумец совершает случайные ходы, тем самым расстраивая логику других личностей и ведя игру по непредсказуемой траектории.</li>
                </ul>
                <p>Используйте приложение, чтобы протестировать эти личности! Задайте матрицу, выберите личностей и число итераций, затем проанализируйте графики балансов и частоты комбинаций, чтобы понять, как прошло взаимодействие выбранных стратегий в данной игре.</p>
            </div>
        </div>
    </div>
    <script src="{% static 'scripts/nash.js' %}"></script>
</body>
</html>