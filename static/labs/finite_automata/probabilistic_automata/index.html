<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–µ–±-—Å–∏–º—É–ª—è—Ç–æ—Ä –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤ - –ù–ò–Ø–£ –ú–ò–§–ò</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="dark">

    <div class="container">
        <header>
            <h1>–í–µ–±-—Å–∏–º—É–ª—è—Ç–æ—Ä –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã—Ö –∫–æ–Ω–µ—á–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤ (–í–ö–ê)</h1>
            <p>–ù–ò–Ø–£ –ú–ò–§–ò - –ò–Ω—Å—Ç–∏—Ç—É—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫–∏–±–µ—Ä–Ω–µ—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º</p>
            <button class="theme-toggle" id="themeToggle">üåô –¢—ë–º–Ω–∞—è —Ç–µ–º–∞</button>
        </header>
        
        <div class="left-panel">
            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–æ–º -->
            <div class="section">
                <div class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–æ–º</div>
                <div class="controls">
                    <button id="add-state">+ –°–æ—Å—Ç–æ—è–Ω–∏–µ</button>
                    <button id="add-symbol">+ –°–∏–º–≤–æ–ª</button>
                    <button id="remove-state">- –°–æ—Å—Ç–æ—è–Ω–∏–µ</button>
                    <button id="remove-symbol">- –°–∏–º–≤–æ–ª</button>
                    <button id="validate">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –í–ö–ê</button>
                </div>
            </div>
            
            <!-- –¢–µ–∫—É—â–∞—è –º–∞—Ç—Ä–∏—Ü–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ -->
            <div class="section" id="probability-panel">
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è probabilityPanel.js -->
            </div>
            
            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π -->
            <div class="section" id="state-settings">
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è stateVisualization.js -->
            </div>
        </div>
        

        <div class="main-content">
            <div class="graph-container" id="graph-view">
                <!-- –ì—Ä–∞—Ñ –∞–≤—Ç–æ–º–∞—Ç–∞ –±—É–¥–µ—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω –∑–¥–µ—Å—å -->
                <div class="state-node initial current" style="top: 100px; left: 150px;">q‚ÇÄ</div>
                <div class="state-node" style="top: 100px; left: 400px;">q‚ÇÅ</div>
                <div class="state-node final" style="top: 300px; left: 270px;">q‚ÇÇ</div>
                
                <!-- –ü–µ—Ä–µ—Ö–æ–¥—ã –±—É–¥—É—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω—ã JavaScript'–æ–º -->
            </div>
            
            <div class="section">
                <div class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–µ–π</div>
                <div class="controls">
                    <button id="start">‚ñ∂ –ó–∞–ø—É—Å–∫</button>
                    <button id="pause">‚è∏ –ü–∞—É–∑–∞</button>
                    <button id="step">‚è≠ –®–∞–≥</button>
                    <button id="reset">‚èπ –°–±—Ä–æ—Å</button>
                    <button id="save">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    

                    
                    <label for="speed">–°–∫–æ—Ä–æ—Å—Ç—å:</label>
                    <input type="range" id="speed" min="1" max="10" value="5">
                    
                    <div class="input-group" style="margin: 0;">
                        <label for="runs">–ü—Ä–æ–≥–æ–Ω–æ–≤:</label>
                        <input type="number" id="runs" value="1" min="1" max="1000" style="width: 60px;">
                    </div>
                </div>
            </div>
            
            <div class="section" id="input-validation">
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è controlSimulator.js -->
            </div>
        </div>
        
        <div class="right-panel">
            <div class="section" id="properties-panel">
                <div class="section-title">–°–≤–æ–π—Å—Ç–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∞</div>
                <div id="markov-property" class="property-indicator">–ú–∞—Ä–∫–æ–≤–æ—Å—Ç—å: ‚Äî</div>
                <div id="ergodicity-property" class="property-indicator">–≠—Ä–≥–æ–¥–∏—á–Ω–æ—Å—Ç—å: ‚Äî</div>
                <div id="irreducibility-property" class="property-indicator">–ù–µ–ø—Ä–∏–≤–æ–¥–∏–º–æ—Å—Ç—å: ‚Äî</div>
                <div id="aperiodicity-property" class="property-indicator">–ê–ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å: ‚Äî</div>
            </div>
            <!-- <div class="section">
                <div class="section-title">–°–≤–æ–π—Å—Ç–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∞</div>
                <div class="property-indicator valid">–ú–∞—Ä–∫–æ–≤–æ—Å—Ç—å: –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è</div>
                <div class="property-indicator warning">–≠—Ä–≥–æ–¥–∏—á–Ω–æ—Å—Ç—å: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è</div>
                <div class="property-indicator valid">–ù–µ–ø—Ä–∏–≤–æ–¥–∏–º–æ—Å—Ç—å: –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è</div>
                <div class="property-indicator invalid">–ê–ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å: –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è</div>
            </div>
            
            <div class="section">
                <div class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏</div>
                <div class="stats-display">
                    <div class="stat-item">
                        <div>–®–∞–≥–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                        <div id="step-counter">0</div>
                    </div>
                    <div class="stat-item">
                        <div>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</div>
                        <div id="time-counter">00:00</div>
                    </div>
                    <div class="stat-item">
                        <div>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</div>
                        <div id="current-state">q‚ÇÄ</div>
                    </div>
                    <div class="stat-item">
                        <div>–ü—Ä–∏–Ω—è—Ç–æ —Å—Ç—Ä–æ–∫</div>
                        <div id="accepted-count">0</div>
                    </div>
                </div>
            </div> -->
            
            <div class="section">
                <div class="section-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π</div>
                <div>–ü–æ—Å–ª–µ N –ø—Ä–æ–≥–æ–Ω–æ–≤:</div>
                <div class="histogram-container" id="histogram"></div>
            </div>

        </div>
        
        <footer>
            <div>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ "–ê–≤—Ç–æ–º–∞—Ç—ã —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏"</div>
            <div>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å: https://study.aia.expert/</div>
        </footer>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤—Å–µ JS —Ñ–∞–π–ª—ã -->
    <script src="scripts/core/state.js"></script>
    <script src="scripts/core/probability.js"></script>
    <script src="scripts/core/transitions.js"></script>
    <script src="scripts/core/automata.js"></script>
    <script src="scripts/core/model.js"></script>
    <script src="scripts/core/simulator.js"></script>
    
    <script src="scripts/algorithms/statistics.js"></script>
    <script src="scripts/algorithms/markov.js"></script>
    <script src="scripts/algorithms/ergodicity.js"></script>
    
    <script src="scripts/state/store.js"></script>
    <script src="scripts/state/persistence.js"></script>
    
    <script src="scripts/ui/stateVisualization.js"></script>
    <script src="scripts/ui/probabilityPanel.js"></script>
    <script src="scripts/ui/graphView.js"></script>
    <script src="scripts/ui/simulationControl.js"></script>
    
    <script src="scripts/main.js"></script>

    <script>
    /*
    –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã: StateVisualization –∏ –º–æ–¥–µ–ª—å –∏–∑ main.js (appModel).
    –≠—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: –Ω–µ –º–µ–Ω—è–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç ES-–º–æ–¥—É–ª–µ–π.
    */

    (function() {
        try {
            // –ü–æ–¥–æ–∂–¥—ë–º, –ø–æ–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç appModel / window.probabilityPanel –∏ —Ç.–ø.
            // –ù–æ –∑–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–¥–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏, –µ—Å–ª–∏ –∫–ª–∞—Å—Å –¥–æ—Å—Ç—É–ø–µ–Ω.
            if (typeof window.StateVisualization === 'function') {
                // StateVisualization –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —É —Ç–µ–±—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç (containerElement, appModel)
                // –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç id –∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä–∏–º –∏ –ø–æ–¥—Å—Ç—Ä–æ–∏–º—Å—è.
                let histContainer = document.getElementById('histogram');

                // –ü–æ–ø—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
                try {
                    // –µ—Å–ª–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ–∂–∏–¥–∞–µ—Ç (element, appModel)
                    window.histogram = new StateVisualization(histContainer, window.appModel || window.probabilityPanel?.appModel);
                } catch (e) {
                    // –∏–Ω–∞—á–µ –≤–æ–∑–º–æ–∂–Ω–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç id
                    try {
                        window.histogram = new StateVisualization('histogram');
                    } catch (err) {
                        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å StateVisualization –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º:', err);
                    }
                }
            } else {
                console.warn('StateVisualization –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ window (–≤–æ–∑–º–æ–∂–Ω–æ, –∑–∞–≥—Ä—É–∂–µ–Ω –ø–æ–∑–∂–µ).');
            }

            // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
            document.addEventListener('simulationComplete', function(event) {
                try {
                    const result = event.detail;
                    if (!result) return;
                    // –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –ø—Ä–æ—à–ª—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É: result.type === 'multiple' –∏ result.results.distribution
                    const distribution = result.results?.distribution || result.results?.finalStates || null;
                    const runs = result.runs || (result.results && result.results.runs) || null;

                    if (window.histogram && typeof window.histogram.renderHistogram === 'function') {
                        window.histogram.renderHistogram(distribution || {}, runs || null);
                    } else {
                        // –µ—Å–ª–∏ –Ω–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä–∞, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
                        console.debug('simulationComplete received, but histogram not initialized.', distribution, runs);
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ simulationComplete:', e);
                }
            });

        } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ histogram listener:', e);
        }
    })();
    </script>

</body>
</html>