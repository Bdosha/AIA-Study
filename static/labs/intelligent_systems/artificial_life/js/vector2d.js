/**
 * Файл: vector2d.js
 * Описание: Класс для работы с двумерными векторами
 * 
 * Реализует математические операции с 2D векторами для:
 * - Позиций агентов и объектов на canvas
 * - Скоростей и ускорений (физика движения)
 * - Вычисления расстояний и направлений
 * - Steering behaviors (seek, flee, avoid)
 * 
 * Вектор представляется двумя компонентами: (x, y)
 * Используется в agent.js для всей физики и навигации
 * 
 * @author Ваше имя
 * @version 1.0
 */

/**
 * Класс двумерного вектора
 * 
 * Представляет точку или направление в 2D пространстве.
 * Методы поддерживают как мутирующие операции (изменяют this),
 * так и создание новых векторов.
 * 
 * @class Vector2D
 * 
 * @example
 * // Создание вектора позиции
 * const position = new Vector2D(100, 200);
 * 
 * @example
 * // Создание вектора скорости
 * const velocity = new Vector2D(2, -1);
 * velocity.normalize(); // Преобразовать в единичный вектор
 * velocity.mult(5);     // Масштабировать до скорости 5
 */
export class Vector2D {
    /**
     * Создаёт новый двумерный вектор
     * 
     * @constructor
     * @param {number} [x=0] - Компонента X вектора (горизонталь)
     * @param {number} [y=0] - Компонента Y вектора (вертикаль)
     * 
     * @example
     * const zero = new Vector2D();        // (0, 0)
     * const pos = new Vector2D(10, 20);   // (10, 20)
     */
    constructor(x = 0, y = 0) {
        /**
         * Компонента X вектора (горизонтальная ось)
         * @type {number}
         */
        this.x = x;
        
        /**
         * Компонента Y вектора (вертикальная ось)
         * @type {number}
         */
        this.y = y;
    }
    
    /* ========================================
       АРИФМЕТИЧЕСКИЕ ОПЕРАЦИИ (МУТИРУЮЩИЕ)
       ======================================== */
    
    /**
     * Складывает текущий вектор с другим вектором (мутирующая операция)
     * 
     * Изменяет текущий вектор: this = this + v
     * Используется для:
     * - Применения ускорения к скорости: velocity.add(acceleration)
     * - Обновления позиции: position.add(velocity)
     * - Накопления сил: totalForce.add(force)
     * 
     * @param {Vector2D} v - Вектор для сложения
     * @returns {Vector2D} - this (для цепочки вызовов)
     * 
     * @example
     * const v1 = new Vector2D(10, 20);
     * const v2 = new Vector2D(5, -10);
     * v1.add(v2);  // v1 теперь (15, 10)
     */
    add(v) {
        this.x += v.x;
        this.y += v.y;
        return this;
    }
    
    /**
     * Вычитает вектор из текущего (НЕ мутирующая операция)
     * 
     * Создаёт НОВЫЙ вектор: result = this - v
     * НЕ изменяет текущий вектор (в отличие от add)
     * 
     * Используется для:
     * - Вычисления направления между двумя точками: target.sub(position)
     * - Расчёта относительных позиций
     * - Steering behaviors (seek, flee)
     * 
     * @param {Vector2D} v - Вектор для вычитания
     * @returns {Vector2D} - Новый вектор (результат вычитания)
     * 
     * @example
     * const target = new Vector2D(100, 100);
     * const agent = new Vector2D(50, 50);
     * const direction = target.sub(agent);  // (50, 50) - направление к цели
     * // agent остаётся (50, 50), создан новый вектор
     */
    sub(v) {
        return new Vector2D(this.x - v.x, this.y - v.y);
    }
    
    /**
     * Умножает вектор на скаляр (мутирующая операция)
     * 
     * Изменяет текущий вектор: this = this * n
     * Масштабирует длину вектора, сохраняя направление.
     * 
     * Используется для:
     * - Изменения скорости: velocity.mult(0.5) - замедление в 2 раза
     * - Масштабирования сил: force.mult(strength)
     * - Нормализации: mult(1/magnitude)
     * 
     * @param {number} n - Скалярный множитель
     * @returns {Vector2D} - this (для цепочки вызовов)
     * 
     * @example
     * const v = new Vector2D(10, 20);
     * v.mult(2);    // v теперь (20, 40)
     * v.mult(0.5);  // v теперь (10, 20)
     */
    mult(n) {
        this.x *= n;
        this.y *= n;
        return this;
    }
    
    /* ========================================
       ВЕКТОРНЫЕ ОПЕРАЦИИ
       ======================================== */
    
    /**
     * Вычисляет длину (магнитуду) вектора
     * 
     * Возвращает евклидову длину вектора: √(x² + y²)
     * НЕ изменяет вектор, только возвращает число.
     * 
     * Используется для:
     * - Проверки текущей скорости агента
     * - Вычисления расстояний
     * - Нормализации вектора
     * 
     * @returns {number} - Длина вектора
     * 
     * @example
     * const v = new Vector2D(3, 4);
     * const length = v.mag();  // 5 (по теореме Пифагора)
     */
    mag() {
        return Math.sqrt(this.x * this.x + this.y * this.y);
    }
    
    /**
     * Нормализует вектор до единичной длины (мутирующая операция)
     * 
     * Изменяет вектор так, чтобы его длина стала равна 1,
     * сохраняя направление. Это называется "единичный вектор".
     * 
     * Используется для:
     * - Получения чистого направления (без учёта длины)
     * - Создания базовых векторов для steering behaviors
     * - Подготовки вектора перед масштабированием
     * 
     * Если длина вектора = 0 (нулевой вектор), ничего не делает.
     * 
     * @returns {Vector2D} - this (для цепочки вызовов)
     * 
     * @example
     * const v = new Vector2D(100, 0);
     * v.normalize();  // v теперь (1, 0) - единичный вектор вправо
     * 
     * @example
     * // Создание вектора с заданным направлением и длиной
     * const direction = target.sub(position);  // Направление к цели
     * direction.normalize().mult(maxSpeed);    // Установить скорость = maxSpeed
     */
    normalize() {
        const m = this.mag();
        if (m > 0) {
            this.mult(1 / m);  // Делим на длину: каждую компоненту на m
        }
        return this;
    }
    
    /**
     * Ограничивает длину вектора максимальным значением (мутирующая операция)
     * 
     * Если текущая длина > max, вектор нормализуется и масштабируется до max.
     * Если текущая длина <= max, вектор не изменяется.
     * 
     * Используется для:
     * - Ограничения максимальной скорости агента: velocity.limit(maxSpeed)
     * - Ограничения силы: force.limit(maxForce)
     * - Предотвращения слишком быстрого движения
     * 
     * @param {number} max - Максимальная допустимая длина
     * @returns {Vector2D} - this (для цепочки вызовов)
     * 
     * @example
     * const velocity = new Vector2D(10, 10);
     * velocity.limit(5);  // Длина была ~14.14, стала 5
     * 
     * @example
     * // В agent.js:
     * this.velocity.add(this.acceleration);  // Применяем ускорение
     * this.velocity.limit(this.maxSpeed);    // Не даём разогнаться выше maxSpeed
     */
    limit(max) {
        if (this.mag() > max) {
            this.normalize().mult(max);
        }
        return this;
    }
    
    /**
     * Создаёт копию вектора
     * 
     * Возвращает новый вектор с теми же компонентами.
     * Полезно, когда нужно сохранить исходный вектор неизменным.
     * 
     * @returns {Vector2D} - Новый вектор-копия
     * 
     * @example
     * const original = new Vector2D(10, 20);
     * const copy = original.copy();
     * copy.mult(2);  // Изменяем копию, original остаётся (10, 20)
     */
    copy() {
        return new Vector2D(this.x, this.y);
    }
    
    /* ========================================
       СТАТИЧЕСКИЕ МЕТОДЫ
       ======================================== */
    
    /**
     * Создаёт случайный единичный вектор (статический метод)
     * 
     * Генерирует вектор длины 1 со случайным направлением (0-360°).
     * Используется для:
     * - Случайного блуждания (WANDER состояние)
     * - Начальной случайной скорости агентов
     * - Добавления случайности в движение
     * 
     * @static
     * @returns {Vector2D} - Случайный единичный вектор
     * 
     * @example
     * // В agent.js, состояние WANDER:
     * const wanderForce = Vector2D.random().mult(0.1);
     * this.applyForce(wanderForce);
     * 
     * @example
     * // В конструкторе Agent:
     * this.velocity = Vector2D.random().mult(Math.random() * 2);
     */
    static random() {
        const angle = Math.random() * 2 * Math.PI;  // Случайный угол 0-2π радиан
        return new Vector2D(Math.cos(angle), Math.sin(angle));
    }
    
    /**
     * Вычисляет евклидово расстояние между двумя векторами (статический метод)
     * 
     * Формула: √((x1-x2)² + (y1-y2)²)
     * 
     * Используется для:
     * - Определения расстояния между агентом и едой
     * - Проверки близости хищника к травоядному
     * - Определения зоны видимости
     * - Обнаружения столкновений
     * 
     * @static
     * @param {Vector2D} v1 - Первый вектор (точка)
     * @param {Vector2D} v2 - Второй вектор (точка)
     * @returns {number} - Расстояние между точками
     * 
     * @example
     * const agent = new Vector2D(100, 100);
     * const food = new Vector2D(150, 150);
     * const distance = Vector2D.dist(agent, food);  // ~70.71
     * 
     * @example
     * // В agent.js, поиск ближайшей еды:
     * const distance = Vector2D.dist(this.position, food.position);
     * if (distance < this.size + food.size) {
     *     // Столкновение - съедаем еду
     * }
     */
    static dist(v1, v2) {
        return Math.sqrt((v1.x - v2.x) ** 2 + (v1.y - v2.y) ** 2);
    }
}
